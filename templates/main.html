<!DOCTYPE html>
<html>

<head>
	<title>blog</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link href='../static/fonts_googleapis.css' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" type="text/css" href="../static/main/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="../static/main/css/animate.css">
	<link rel="stylesheet" type="text/css" href="../static/main/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="../static/main/css/bootstrap-select.min.css">
	<link rel="stylesheet" type="text/css" href="../static/main/css/awesome-bootstrap-checkbox.css">
	<link rel="stylesheet" type="text/css" href="../static/jquery.dataTables.min.css">

	<link rel="stylesheet" type="text/css" href="../static/main/css/select2.css">
	<link rel="stylesheet" type="text/css" href="../static/main/css/style.css">
	<link rel="stylesheet" type="text/css" href="../static/main/css/theme.css">
	<link rel="stylesheet" type="text/css" href="../static/page.css">

	<script src="../static/jquery-2.1.4.js"></script>
	<script src="../static/bootstrap-3.3.7-dist 2/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="../static/main/js/Chart.min.js"></script>
	<script type="text/javascript" src="../static/main/js/bootstrap-select.min.js"></script>
	<script type="text/javascript" src="../static/main/js/main.js"></script>
	<script type="text/javascript" src="../static/main/js/index.js"></script>
	<script type="text/javascript" src="../static/page.js"></script>
	<script type="text/javascript" src="../static/Convert_Pinyin.js"></script>
	<script type="text/javascript" src="../static/jquery.dataTables.min.js"></script>

	<script type="text/javascript" src="../static/jquery.form.js"></script>
	<style type="text/css">
		#datatable_xs {
			text-align: center;
		}

		th {
			text-align: center;
		}

		.alert {
			display: none;
			position: fixed;
			top: 50%;
			left: 50%;
			min-width: 300px;
			max-width: 600px;
			transform: translate(-50%, -50%);
			z-index: 99999;
			text-align: center;
			padding: 15px;
			border-radius: 3px;
		}

		.alert-success {
			color: #3c763d;
			background-color: #dff0d8;
			border-color: #d6e9c6;
		}

		.alert-info {
			color: #31708f;
			background-color: #d9edf7;
			border-color: #bce8f1;
		}

		.alert-warning {
			color: #8a6d3b;
			background-color: #fcf8e3;
			border-color: #faebcc;
		}

		.alert-danger {
			color: #a94442;
			background-color: #f2dede;
			border-color: #ebccd1;
		}

		td {
			text-align: center!important;
			vertical-align: middle!important;
		}

		.dataTables_length {
			display: none!important;
		}
	</style>

</head>

<body class="flat-blue sidebar-collapse">
	<div class="alert"></div>

	<div class="sidebar">
		<div class="menu-control toggle-sidebar">
			<a class="navbar-brand" href="#" class="atitle"></a>
			<i class="fa fa-bars navicon"></i>
		</div>
		{% include 'public_left.html' %}

	</div>

	<div class="content-container wrap">
		<nav class="navbar navbar-default">
			<div>

				<!-- Collect the nav links, forms, and other content for toggling -->
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="#" ><span class="atitle"></span>列表</a>
					</div>


				</div>
				<!-- /.navbar-collapse -->
			</div>
			<!-- /.container-fluid -->
		</nav>
		<div class="container-fluid">
			<div class="row">
				<div class="col-xs-12">
					<span class="page-title red"><h2><span class="atitle"></span>列表</h2></span>
				</div>
				<button id="tianjiadianbu" class="btn btn-primary btn-sm">
					添加<span class="atitle"></span>
				</button>
				<button id="tianjiadianbu2" style="display: none" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#addUserModal">
					展示弹窗
				</button>
			</div>

			<div class="row">
				<table class="table display" id="datatable_xs" style="border: 1px solid RGBA(62, 70, 81, 1)">
					<thead>
						<tr id="tou">
						</tr>
					</thead>
				</table>
			</div>
		</div>
	</div>

	<!-- 模态框示例（Modal） -->
	<div class="form-horizontal" role="form" id="form_data" style="margin: 20px;">
		<div class="modal fadein" id="addUserModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
							&times;
						</button>
						<h4 class="modal-title" id="myModalLabel">
							<span class="atitle"></span>信息
						</h4>
					</div>
					<div class="modal-body">
						<form class="form-horizontal" id="add" role="form">


						</form>
					</div>
					<div class="modal-footer">
						<button id="guanbi" type="button" class="btn btn-default" data-dismiss="modal">关闭
						</button>
						<button type="button" id="tijiao" class="btn btn-primary">
							提交
						</button><span id="tip"> </span>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal -->
		</div>
	</div>

	<footer class="footer">
		<span><i class="fa fa-copyright"></i> 个人博客 </span>
	</footer>
	<script type="application/javascript">
		loadIndex(1)

		var title = "专业管理"
		$('.atitle').each(function(i,o){
			$(o).text(title.replace('管理',''))
		})
		$('#atitle').val(title+'列表')
		var showString = '名称、介绍、所属院校、学费'
		var addString = '名称、介绍、所属院校、学费'
		var fujian = '身份证件'
		var prompt = function(message, style, time) {
			style = (style === undefined) ? 'alert-success' : style;
			time = (time === undefined) ? 1200 : time;
			$('<div>')
			.appendTo('body')
			.addClass('alert ' + style)
			.html(message)
			.show()
			.delay(time)
			.fadeOut();
		};

			// 成功提示
			var success_prompt = function(message, time) {
				prompt(message, 'alert-success', time);
			};

			// 失败提示
			var fail_prompt = function(message, time) {
				prompt(message, 'alert-danger', time);
			};

			// 提醒
			var warning_prompt = function(message, time) {
				prompt(message, 'alert-warning', time);
			};

			// 信息提示
			var info_prompt = function(message, time) {
				prompt(message, 'alert-info', time);
			};

			$('#YongYouZhe').val(window.localStorage.nowname)

			$('#tijiao').click(function() {
				var aurl = 'add'+pinyin.getFullChars(title)

				$("#add").attr('action',aurl)
				if(isbianji == true) {
					aurl = 'update'+pinyin.getFullChars(title)
					$('#id').remove()
					$('#add').append('<input id="id" name = "id" value = "'+tdata['id']+'" style="display:none"/>')
					$('#'+pinyin.getFullChars('申请状态')).remove()
					$('#add').append('<input style="display:none" id="'+pinyin.getFullChars('申请状态')+'" name = "'+pinyin.getFullChars('申请状态')+'" value = "'+tdata[pinyin.getFullChars('申请状态')]+'"/>')

				} else {
					$('#'+pinyin.getFullChars('申请状态')).remove()
					$('#add').append('<input style="display:none" id="'+pinyin.getFullChars('申请状态')+'" name = "'+pinyin.getFullChars('申请状态')+'" value = "'+'审核中'+'"/>')
					$('.edit').each(function(i, o) {
						$(o).remove()
					})
				}

				var options = {
					url: aurl, //同action
					type: 'post',
					beforeSend: function(xhr) { //请求之前

					},
					success: function(data) {
						$('#add')[0].reset();
						$('#guanbi').click()
						success_prompt(data.msg, 750)

						$("#datatable_xs").dataTable()._fnAjaxUpdate();

					},
					complete: function(xhr) {

					},
					error: function(xhr, status, msg) {

					}
				};
				$("#add").ajaxSubmit(options);
			})

			function toujianli(data) {
				$.post('delete'+pinyin.getFullChars(title), {
					"id": data.id
				}, function(data) {
					success_prompt(data.msg, 750)
					$("#datatable_xs").dataTable()._fnAjaxUpdate();
				})
			}
			$('#tianjiadianbu').click(function() {
				isbianji = false
				$('#tianjiadianbu2').click()
			})
			var isbianji = false
			var tdata
			function bianji(data) {
				tdata=data
				$('#tianjiadianbu').click()

				$('#add input').each(function(i, o) {
					if($(o).attr('type')=='file'){

						return true
					}
					$(o).val(data[$(o).attr('name')])
				})
				isbianji = true
			}

			function zhuangtai(data) {
				data.ZhuangTai = (data.ZhuangTai == "禁用" ? "启用" : "禁用")
				$.post('updateDianPu', data, function(data) {
					success_prompt(data.msg, 750)
					$("#datatable_xs").dataTable()._fnAjaxUpdate();
				})
			}

			var arr = showString.split('、')
			var string = ''
			var barr = []

			var arr2 = addString.split('、')

			for(var i in arr2) {
				if(arr2[i]=='操作'){

				}else{
					if(arr2[i] == fujian) {
						$('#add').append('<div class="form-group">'+
							'<label for="user_id" class="col-sm-3 control-label">'+arr2[i]+'</label>'+
							'<div class="col-sm-9">'+
							'<input type="file" class="form-control" id="'+pinyin.getFullChars(arr2[i])+'" name="icon" >'+
							'<input type="text" class="form-control" name="'+pinyin.getFullChars(arr2[i])+'" style="display:none">'+

							'</div>'+
							'</div>')

						$('#'+pinyin.getFullChars(arr2[i])).change(function() {
							var  tname = $(this).attr('id')

							var options = {
								url: 'daoruaction', //同action
								type: 'post',
								beforeSend: function(xhr) { //请求之前

								},
								success: function(data) {
									// 　　　　　　	alert(data.msg)
									$('input').each(function(i,o){
										if($(o).attr('name')==tname){
											$(o).val(data.path)
										}
									})
									// $('#'+tname).val(data.path)
								},

								complete: function(xhr) {

								},
								error: function(xhr, status, msg) {

								}
							};
							$("#add").ajaxSubmit(options);
						})

					}
					else{
						$('#add').append('<div class="form-group">'+
							'<label for="user_id" class="col-sm-3 control-label">'+arr[i]+'</label>'+
							'<div class="col-sm-9">'+
							'<input type="text" class="form-control" id="'+pinyin.getFullChars(arr[i])+'" name="'+pinyin.getFullChars(arr[i])+'" placeholder="请输入'+arr[i]+'">'+
							'</div>'+
							'</div>')
					}
					
				}
			}



			for(var i in arr) {


				if(arr[i] == "图片") {
					string = string + '<th>' + arr[i] + '</th>'
					barr.push({
						"render": function(data, type, row) {
							// alert(JSON.stringify(pinyin.getFullChars(arr[i])))

							var html = "<img style='width:60px;height:60px' src='"+row['TuPian']+"'/>"
							return html;
						}
					})
					continue

				}

				// <i class='fa fa-arrow-up'></i>
				if(arr[i] == "操作") {
					string = string + '<th>' + arr[i] + '</th>'
					barr.push({
						"render": function(data, type, row) {
							var html = "<a href='javascript:void(0);' onclick='toujianli(" + JSON.stringify(row) + ")'  class='up btn btn-default btn-xs'> 查看专业</a>"
							// +"<a href='javascript:void(0);' onclick='bianji(" + JSON.stringify(row) + ")'  class='up btn btn-default btn-xs'> 编辑</a>"
							return html;
						}
					})
					continue
				}
				if(arr[i] == '所属院校') {
					string = string + '<th>' + arr[i] + '</th>'
					barr.push({
						"render": function(data, type, row) {
							var html = "<span class='xuexiao'>"+row[pinyin.getFullChars('所属院校')]+"</span>"
							// +"<a href='javascript:void(0);' onclick='bianji(" + JSON.stringify(row) + ")'  class='up btn btn-default btn-xs'> 编辑</a>"
							return html;
						}
					})
					continue
				}
				if(arr[i] == fujian) {
					string = string + '<th>' + arr[i] + '</th>'
					barr.push({
						"render": function(data, type, row) {
							var html = "<a href='"+row[pinyin.getFullChars(fujian)]+"'>附件</a>"
							return html;
						}
					})
					continue
				}

				string = string + '<th>' + arr[i] + '</th>'
				barr.push({
					'data': pinyin.getFullChars(arr[i])
				})
			}

			$('#tou').append(string)

			function shengcheng() {
				//表格生成
				$('#datatable_xs').DataTable({
					'language': {
						"sProcessing": "处理中...",
						"sLengthMenu": "显示 _MENU_ 项结果",
						"sZeroRecords": "没有匹配结果",
						"sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
						"sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
						"sInfoFiltered": "(由 _MAX_ 项结果过滤)",
						"sInfoPostFix": "",
						"sSearch": "搜索:",
						"sUrl": "",
						"sEmptyTable": "表中数据为空",
						"sLoadingRecords": "载入中...",
						"sInfoThousands": ",",
						"oPaginate": {
							"sFirst": "首页",
							"sPrevious": "上页",
							"sNext": "下页",
							"sLast": "末页"
						},
						"oAria": {
							"sSortAscending": ": 以升序排列此列",
							"sSortDescending": ": 以降序排列此列"
						}
					},
					"processing": true,
					"searching": false,
					"serverSide": false,
					"ajax": {
						"url": "getdata?database=admin&table="+pinyin.getFullChars(title),
					},
					"columns": barr
				});
			}
			shengcheng()
			function getQueryString(name) {
				var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
				var r = window.location.search.substr(1).match(reg);
				if ( r != null ){
					return decodeURI(r[2]);
				}else{
					return null;
				} 
			}
			setTimeout(function(){
				var name = getQueryString('name')
				$('.xuexiao').each(function(i,o){
					if($(o).text()!=name){
						$(o).parent().parent().css('display','none')
					}
				})
			},500)
		</script>
	</body>

	</html>